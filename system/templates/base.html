{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Blood Heroes{% endblock %}</title>
    <link rel="stylesheet" href="{% static 'css/base.css' %}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Playfair+Display:wght@700&display=swap" rel="stylesheet">
    {% block extra_css %}{% endblock %}
</head>
<body>
    <!-- Floating decorative hearts -->
    <div class="floating-hearts">
        <i class="fa fa-heart heart"></i>
        <i class="fa fa-heart heart"></i>
        <i class="fa fa-heart heart"></i>
        <i class="fa fa-heart heart"></i>
        <i class="fa fa-heart heart"></i>
    </div>

    <!-- Top Navigation Bar -->
    <nav class="top-nav">
        <div class="nav-brand">
            <h1>Blood Heroes</h1>
        </div>
        <div class="nav-links">
            <ul>
                <li>
                    <a href="#" id="bell-icon">
                        <i class="fa fa-bell"></i>
                        <span id="notification-count"></span> Requests
                    </a>
                </li>
                <li><a href="{% url 'view_profiles' %}"><i class="fa fa-users"></i> Contact Donors</a></li>
                <li><a href="{% url 'home' %}"><i class="fa fa-sign-out"></i> Logout</a></li>
            </ul>
        </div>    
    </nav>

    <!-- Sidebar Navigation -->
    <aside class="sidebar">
        <div class="profile-card">
            {% if user.profile.photo %}
                <img src="{{ user.profile.photo.url }}" alt="Profile Photo" class="profile-img">
            {% else %}
                <img src="{% static 'images/default-profile.jpg' %}" alt="Default Profile" class="profile-img">
            {% endif %}
            <div class="profile-info">
                <h3>Welcome</h3>
                <p>{{ user.first_name }} {{ user.last_name }}</p>
            </div>
        </div>

        <nav class="sidebar-nav">
            <ul>
                <li>
                    <a href="{% url 'dashboard' %}" class="{% if request.path == '/dashboard/' %}active{% endif %}">
                        <i class="fa fa-home"></i>
                        <span>Dashboard</span>
                    </a>
                </li>
                <li>
                    <a href="{% url 'edit' %}" class="{% if request.path == '/edit/' %}active{% endif %}">
                        <i class="fa fa-user-edit"></i>
                        <span>Edit Profile</span>
                    </a>
                </li>
                <li>
                    <a href="{% url 'book_appointment' %}" class="{% if request.path == '/book-appointment/' %}active{% endif %}">
                        <i class="fa fa-calendar-check"></i>
                        <span>Book Donation</span>
                    </a>
                </li>
                <li>
                    <a href="{% url 'schedule' %}" class="{% if request.path == '/schedule/' %}active{% endif %}">
                        <i class="fa fa-calendar-times"></i>
                        <span>Cancel Booking</span>
                    </a>
                </li>
                <li>
                    <a href="{% url 'donation_report' %}" class="{% if request.path == '/donation-report/' %}active{% endif %}">
                        <i class="fa fa-file-alt"></i>
                        <span>Donations Report</span>
                    </a>
                </li>
                <li>
                    <a href="{% url 'reward_certificate' %}" class="{% if request.path == '/rewards/' %}active{% endif %}">
                        <i class="fa fa-award"></i>
                        <span>Rewards</span>
                    </a>
                </li>
                <li class="logout-link">
                    <a href="{% url 'logout' %}">
                        <i class="fa fa-sign-out-alt"></i>
                        <span>Log out</span>
                    </a>
                </li>
            </ul>
        </nav>
    </aside>

    <!-- Main Content Area -->
    <main class="content">
        {% block content %}
        <!-- Content from other templates will be inserted here -->
        {% endblock %}
    </main>

    <!-- Include jQuery -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    
    <!-- Base JavaScript -->
    <script>
        // Update notification count
        function updateBloodRequestCount() {
            $.ajax({
                url: "{% url 'blood_request_count' %}",
                dataType: 'json',
                success: function(data) {
                    $('#notification-count').text(data.count);
                }
            });
        }

        // Initialize and update periodically
        $(document).ready(function() {
            updateBloodRequestCount();
            setInterval(updateBloodRequestCount, 5000); // Update every 5 seconds
            
            // Notification bell click handler
            $('#bell-icon').click(function(e) {
                e.preventDefault();
                window.location.href = "{% url 'blood_requests' %}";
            });
        });
    </script>
    
    {% block extra_js %}{% endblock %}
</body>
</html>